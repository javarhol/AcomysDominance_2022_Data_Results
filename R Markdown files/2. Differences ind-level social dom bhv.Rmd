---
title: "2. Differences ind-level social dom bhv"
author: "Justin Varholick"
date: '2022-06-14'
output: html_document
---

```{r setup}
library(tidyverse)
library(readxl)

library(lubridate)
library(igraph)

library(ggplot2)
library(ggsci)
library(cowplot)
library(ggthemr)

ggthemr('flat')
```
##Extract data from BORIS
1 Open project file in BORIS
2 Click the Observations Menu > Export Events > aggregated events
3 Select the observations you wish to export, then all subjects and all behaviors
4 Click YES for group events into one file
5 Save as .csv file
6 edit in excel 
  1. split by "_" delimiter into 6 columns
  2. remove "MVI" from data
  3. Check all dates are actual dates (remove "2020")
  4. check all hours are actual hours (replace pt1, and shift 21 and 12 which extend to next column)
  5. check that all columns have the correct data, delete the coder initials data

```{r import data}
adata <- read.csv("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/dominanceevents_MASTER_adj.csv", stringsAsFactors=TRUE)

#Fixing observation.id inconsistencies...
adata$Cage <- adata$Observation.id
adata$Subject <- gsub("Mouse ","", as.factor(adata$Subject))
adata$Date <- gsub("-Jan","01", adata$Date)
adata$Modifiers <- gsub("None", "3", adata$Modifiers)
adata$Date <- gsub("3001", "20200130", adata$Date)
adata$Date <- gsub("2901", "20200129", adata$Date)
adata$Date <- gsub("2801", "20200128", adata$Date)
adata$Date <- gsub("2301", "20200123", adata$Date)
adata$Date <- gsub("2201", "20200122", adata$Date)
adata$Date <- gsub("2101", "20200121", adata$Date)
adata$Date <- gsub("730", "20190730", adata$Date)
adata$Date <- gsub("731", "20190731", adata$Date)
adata$Date <- gsub("801", "20190801", adata$Date)
adata$Date <- gsub("806", "20190806", adata$Date)
adata$Date <- gsub("807", "20190807", adata$Date)
adata$Date <- gsub("808", "20190808", adata$Date)
adata$Date <- gsub("815", "20190815", adata$Date)
adata$Date <- gsub("816", "20190816", adata$Date)
adata$Date <- gsub("817", "20190817", adata$Date)
adata$Date <- gsub("2019020190731", "20190731", adata$Date)
adata$Date <- gsub("2019020190807", "20190807", adata$Date)
adata$Date <- gsub("916", "20200916", adata$Date)
adata$Date <- gsub("922", "20200922", adata$Date)
adata$Date <- gsub("923", "20200923", adata$Date)
adata$Date <- gsub("2020020200916", "20200916", adata$Date)
adata$Date <- gsub("2020020200922", "20200922", adata$Date)
adata$Date <- gsub("2020020200923", "20200923", adata$Date)

adata$Hour2 <- paste(adata$Hour, "00", sep=":")
adata$Date <- ymd(adata$Date)
adata$DateHour <- paste(adata$Date, adata$Hour2, sep=" ")
adata$DateHour <- as.POSIXct(adata$DateHour, tz="America/New_York")
adata$DateHour <- ymd_hms(adata$DateHour)

adata$Start..s. <- duration(adata$Start..s., "seconds")
adata$Stop..s. <- duration(adata$Stop..s., "seconds")

adata$Start <- (adata$DateHour + adata$Start..s.)
adata$Stop <- (adata$DateHour + adata$Stop..s.)

ag <- adata %>% 
  within(Opponent.1 <- paste(Cage, Subject, sep="-")) %>% 
  within(value <- paste("1")) %>% 
  select(Opponent.1, value, Date, Behavior, Behavioral.category, Modifiers, Cage, Week)

locations <- ag %>% 
  filter(Behavioral.category=="Location") %>% 
  filter(Behavior!="Shelter") %>% 
  filter(Behavior!="Food Hopper") %>% 
  filter(Behavior!="Cup") %>% 
  unite("Behavior2", Behavior, Modifiers, sep="-", remove=T) %>% 
  rename("Behavior"=Behavior2)

ag <- ag %>% 
  filter(Behavioral.category!="Location") %>% 
  select(Opponent.1, value, Date, Behavior, Behavioral.category, Cage, Week)
ag <- rbind(ag, locations)

#add independent variables
sex_id <- read_excel("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/AcomysDomRegen_Inventory.xlsx", sheet = "Sheet3")
sex_id$Cage <- as.factor(sex_id$Cage)
ag$Cage <- as.factor(ag$Cage)

ag <- left_join(ag, sex_id, by="Cage")

```
##Division of experimental groups
```{r filter exp groups}
sexdyads <- ag %>% 
  filter(GrpSize==2) %>% 
  filter(Age=="Young")

grpsize_male <- ag %>% 
  filter(Sex=="M")

age_female <- ag %>% 
  filter(Sex=="F")

```

##Sex Effects
```{r plot sex effects}
#sex effects

sexdyads <- sexdyads %>% 
  group_by(Cage, Opponent.1, Sex, Behavior) %>% 
  count(value)

zeromatrix <- ag %>%
  filter(GrpSize==2) %>% 
  filter(Age=="Young") %>% 
  select(Opponent.1, Sex, Cage) %>% 
  unique() %>% 
  mutate(Chasing=0) %>% 
  mutate(Mounting=0) %>% 
  mutate(Attacking=0) %>% 
  mutate(Stealing=0) %>% 
  mutate(Fleeing=0) %>% 
  mutate(`Induced Flee`=0) %>%
  mutate(Freeze=0) %>% 
  mutate(Unseen=0) %>% 
  mutate(Inactive=0) %>% 
  mutate(`Top-Left`=0) %>% 
  mutate(`Top-Right`=0) %>% 
  mutate(`Bottom-Left`=0) %>% 
  mutate(`Bottom-Right`=0) %>% 
  gather("Behavior", "n_prime", 4:16)

sexdyads_zeros <- left_join(zeromatrix, sexdyads, by=(c("Opponent.1", "Sex", "Cage", "Behavior")))
sexdyads_zeros[is.na(sexdyads_zeros)]<-0

sexdyads_ag <- sexdyads_zeros %>% 
  filter(Behavior!="Top-Right") %>% 
  filter(Behavior!="Top-Left") %>% 
  filter(Behavior!="Bottom-Right") %>% 
  filter(Behavior!="Bottom-Left")

sexdyads_ag$Behavior <- factor(sexdyads_ag$Behavior, levels=c("Chasing", "Mounting", "Attacking", "Stealing", "Fleeing", "Induced Flee", "Freeze", "Unseen", "Inactive"))

ggplot(sexdyads_ag, aes(Behavior, n, fill=Sex))+
  geom_boxplot()+
  xlab("")+
  scale_fill_npg()
  
```
```{r sex effect chasing}

chase_m <- sexdyads_ag %>% 
  filter(Behavior=="Chasing") %>% 
  filter(Sex=="M")

chase_f <- sexdyads_ag %>% 
  filter(Behavior=="Chasing") %>% 
  filter(Sex=="F")

wilcox.test(chase_f$n, chase_m$n, paired=F)

```

```{r sex effect induced flee}
if_m <- sexdyads_ag %>% 
  filter(Behavior=="Induced Flee") %>% 
  filter(Sex=="M")

if_f <- sexdyads_ag %>% 
  filter(Behavior=="Induced Flee") %>% 
  filter(Sex=="F")

wilcox.test(if_f$n, if_m$n, paired=F)
```
##Group Size Effects, Males
```{r}
grpsize_male <- grpsize_male %>% 
  group_by(Cage, Opponent.1, GrpSize, Behavior) %>% 
  count(value)

zeromatrix <- ag %>%
  filter(Sex=="M") %>% 
  filter(Age=="Young") %>% 
  select(Opponent.1, GrpSize, Cage) %>% 
  unique() %>% 
  mutate(Chasing=0) %>% 
  mutate(Mounting=0) %>% 
  mutate(Attacking=0) %>% 
  mutate(Stealing=0) %>% 
  mutate(Fleeing=0) %>% 
  mutate(`Induced Flee`=0) %>%
  mutate(Freeze=0) %>% 
  mutate(Unseen=0) %>% 
  mutate(Inactive=0) %>% 
  mutate(`Top-Left`=0) %>% 
  mutate(`Top-Right`=0) %>% 
  mutate(`Bottom-Left`=0) %>% 
  mutate(`Bottom-Right`=0) %>% 
  gather("Behavior", "n_prime", 4:16)

grpsize_zeros <- left_join(zeromatrix, grpsize_male, by=(c("Opponent.1", "GrpSize", "Cage", "Behavior")))
grpsize_zeros[is.na(grpsize_zeros)]<-0

grpsize_ag <- grpsize_zeros %>% 
  filter(Behavior!="Top-Right") %>% 
  filter(Behavior!="Top-Left") %>% 
  filter(Behavior!="Bottom-Right") %>% 
  filter(Behavior!="Bottom-Left")

grpsize_ag$Behavior <- factor(grpsize_ag$Behavior, levels=c("Chasing", "Mounting", "Attacking", "Stealing", "Fleeing", "Induced Flee", "Freeze", "Unseen", "Inactive"))

ggplot(grpsize_ag, aes(Behavior, n, fill=as.factor(GrpSize)))+
  geom_boxplot()+
  xlab("")+
  scale_fill_npg()+
  labs(fill="Group Size")
  
```
#Age effects, Female
```{r}
age_female <- ag %>% 
  filter(Sex=="F")

age_female <- age_female %>% 
  group_by(Cage, Opponent.1, Age, Behavior) %>% 
  count(value)

zeromatrix <- ag %>%
  filter(Sex=="F") %>% 
  select(Opponent.1, Age, Cage) %>% 
  unique() %>% 
  mutate(Chasing=0) %>% 
  mutate(Mounting=0) %>% 
  mutate(Attacking=0) %>% 
  mutate(Stealing=0) %>% 
  mutate(Fleeing=0) %>% 
  mutate(`Induced Flee`=0) %>%
  mutate(Freeze=0) %>% 
  mutate(Unseen=0) %>% 
  mutate(Inactive=0) %>% 
  mutate(`Top-Left`=0) %>% 
  mutate(`Top-Right`=0) %>% 
  mutate(`Bottom-Left`=0) %>% 
  mutate(`Bottom-Right`=0) %>% 
  gather("Behavior", "n_prime", 4:16)

age_zeros <- left_join(zeromatrix, age_female, by=(c("Opponent.1", "Age", "Cage", "Behavior")))
age_zeros[is.na(age_zeros)]<-0

age_ag <- age_zeros %>% 
  filter(Behavior!="Top-Right") %>% 
  filter(Behavior!="Top-Left") %>% 
  filter(Behavior!="Bottom-Right") %>% 
  filter(Behavior!="Bottom-Left")

age_ag$Behavior <- factor(age_ag$Behavior, levels=c("Chasing", "Mounting", "Attacking", "Stealing", "Fleeing", "Induced Flee", "Freeze", "Unseen", "Inactive"))

ggplot(age_ag, aes(Behavior, n, fill=Age))+
  geom_boxplot()+
  xlab("")+
  scale_fill_npg()
```

```{r age effect induced flee}
if_y <- age_ag %>% 
  filter(Behavior=="Induced Flee") %>% 
  filter(Age=="Young")

if_o <- age_ag %>% 
  filter(Behavior=="Induced Flee") %>% 
  filter(Age=="Old")

wilcox.test(if_y$n, if_o$n, paired=F)
```

```{r age effect chase}
chase_y <- age_ag %>% 
  filter(Behavior=="Chasing") %>% 
  filter(Age=="Young")

chase_o <- age_ag %>% 
  filter(Behavior=="Chasing") %>% 
  filter(Age=="Old")

wilcox.test(chase_y$n, chase_o$n, paired=F)
```

```{r age effect inactive}
in_y <- age_ag %>% 
  filter(Behavior=="Inactive") %>% 
  filter(Age=="Young")

in_o <- age_ag %>% 
  filter(Behavior=="Inactive") %>% 
  filter(Age=="Old")

wilcox.test(in_y$n, in_o$n, paired=F)
```