---
title: "8. blood serum"
author: "varholick"
date: "8/3/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#plots
library(tidyverse)
library(ggplot2)
library(ggbeeswarm)
library(ggthemr) #devtools::install_github('Mikata-Project/ggthemr')
library(ggsci)
library(ggpubr)
library(cowplot)
library(readxl)

#stats
library(psych)
library(lme4)
library(lmerTest)
library(MuMIn)

ggthemr('flat')
```

# data organization
```{r}
cort_data <- read.csv("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/cort_combined.csv", header=TRUE)

sex_id <- read_excel("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/AcomysDomRegen_Inventory.xlsx", sheet = "Sheet1")
ind_ds <- read.csv("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/dscorebyanimal_edited.csv")
eardata <- read_excel("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/EarDaysToClose.xlsx")
stability <- read.csv("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/stabilitybycage.csv")

cort_data <- left_join(cort_data, sex_id[,1:16], by="AnimalID")
cort_data <- left_join(cort_data, ind_ds, by="AnimalID")
cort_data <- left_join(cort_data, stability, by="AnimalID")
cort_data <- left_join(cort_data, eardata, by="AnimalID")

cort_data$Sex.x <- as.factor(cort_data$Sex.x)
cort_data$Cage.x <- as.factor(cort_data$Cage.x)
cort_data$GrpSize <- as.factor(cort_data$GrpSize)
cort_data$dom_status_ds <- as.factor(cort_data$dom_status_ds)
cort_data$stab_status <- factor(cort_data$stab_status, levels=c("Stable", "Unstable", "Unclear"))

cort_data <- filter(cort_data, Sex.x!="F")
```

```{r}
m.cort.full <- lmer(ng ~ (1|Cage.x) + ds + stab_status + ds*stab_status, data=cort_data)
m.cort.simp <- lm(ng ~ ds + stab_status + ds*stab_status, data=cort_data)


anova(m.cort.full)
summary(m.cort.full)
anova(m.cort.simp)

r.squaredGLMM(m.cort.simp)
r.squaredGLMM(m.cort.full)
```

```{r}
cor.test(cort_data$DaysToClose, cort_data$ng, test="spearman")
```


```{r}
cortplot <- ggplot(cort_data, aes(ds, ng))+
  geom_point(aes(color=stab_status), size=4)+
  geom_smooth(aes(color=stab_status), method=lm, se=FALSE, size=1.5)+
  scale_x_continuous(limits=c(-3,3), breaks=c(-3,-2,-1,0,1,2,3))+
  scale_color_npg()+
  xlab("David's Score") + ylab("ng of Cortisol")+
  labs(color="Stability")
cortplot
```

```{r}
corrplot<- ggplot(cort_data, aes(DaysToClose, ng)) +
  geom_point(size=4) +
  geom_smooth(method=lm, se=FALSE, size=1.5, color="black")+
  xlab("Days to close ear") + ylab("ng of Cortisol")
corrplot
```
```{r}
fig6 <- plot_grid(
  cortplot, corrplot,
  labels="AUTO", ncol=1, align="v"
)

ggsave("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/R generated figures/Fig6_cort_plots.tiff", fig6, units="cm", width = 15, height = 15, device='tiff', dpi=300)

fig6
```

