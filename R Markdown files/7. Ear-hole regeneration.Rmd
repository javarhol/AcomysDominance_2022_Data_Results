---
title: "7. Ear-hole regeneration"
author: "varholick"
date: "8/3/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#plots
library(tidyverse)
library(ggplot2)
library(ggbeeswarm)
library(ggthemr) #devtools::install_github('Mikata-Project/ggthemr')
library(ggsci)
library(ggpubr)
library(cowplot)
library(readxl)

#stats
library(psych)
library(lme4)
library(lmerTest)
library(MuMIn)

ggthemr('flat')
```
#organize data
```{r}
eardata <- read_excel("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/EarDaysToClose.xlsx")
sex_id <- read_excel("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/AcomysDomRegen_Inventory.xlsx", sheet = "Sheet1")
ind_ds <- read.csv("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/dscorebyanimal_edited.csv")
stability <- read.csv("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/stabilitybycage.csv")

eardata <- left_join(eardata, sex_id[,1:16], by="AnimalID")
eardata <- left_join(eardata, ind_ds, by="AnimalID")
eardata <- left_join(eardata, stability, by="AnimalID")

eardata$Sex <- as.factor(eardata$Sex)
eardata$Cage.x <- as.factor(eardata$Cage.x)
eardata$GrpSize <- as.factor(eardata$GrpSize)
eardata$dom_status_ds <- as.factor(eardata$dom_status_ds)
eardata$stab_status2 <- factor(eardata$stab_status2, levels=c("Enforced stable", "Unstable", "Unenforced stable", "Unmeasurable"))
```

#mixed model
```{r}
m.earclose.full <- lmer(DaysToClose ~ (1|Cage.x) + ds + stab_status2 + ds*stab_status2, data=eardata)
m.earclose.simp <- lm(DaysToClose ~ ds + stab_status2 + ds*stab_status2, data=eardata)

m.earclose.age <- lmer(DaysToClose ~ (1|Cage.x) + AgeAtTest + ds + stab_status2 + ds*stab_status2, data=eardata)

anova(m.earclose.full)
summary(m.earclose.full)
print("Age Model")
anova(m.earclose.age)
summary(m.earclose.full)

r.squaredGLMM(m.earclose.simp)
r.squaredGLMM(m.earclose.full)
r.squaredGLMM(m.earclose.age)
```

```{r}
earplot <- ggplot(eardata, aes(ds, DaysToClose))+
  geom_point(aes(color=stab_status2), size=1)+
  geom_smooth(aes(color=stab_status2), method=lm, se=FALSE, size=1)+
  scale_x_continuous(limits=c(-3,3), breaks=c(-3,-2,-1,0,1,2,3))+
  scale_color_npg()+
  xlab("David's Score") + ylab("Days to close ear")+
  annotate("text", x = c(-2.525,2.525), y = c(2,2), label = c("more subordinate","more dominant"))+
  labs(color="Type of \n Dom. Relationship")+
  theme(text = element_text(size = 10)) 
earplot
```
```{r}
ggsave("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/R generated figures/fig5_ear.tiff", earplot, units="in", width = 6, height = 3, device='tiff', dpi=300)

```

```{r, age plot}
ageplot <- ggplot(eardata, aes(AgeAtTest, DaysToClose))+
  geom_point(aes(color=stab_status2), size=4)+
  scale_color_npg()+
  xlab("Age at experiment d0") + ylab("Days to close ear")+
  labs(color="Type of \n Dom. Relationship")
ageplot
```
```{r}
ggsave("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/R generated figures/SIFig_age_ear.tiff", ageplot, units="in", width = 6, height = 3, device='tiff', dpi=300)
```








