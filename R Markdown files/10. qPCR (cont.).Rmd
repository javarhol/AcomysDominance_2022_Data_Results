---
title: "10. qPCR (cont.)"
author: "varholick"
date: "1/3/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#plots
library(tidyverse)
library(ggplot2)
library(ggbeeswarm)
library(ggthemr) #devtools::install_github('Mikata-Project/ggthemr')
library(ggsci)
library(ggpubr)
library(cowplot)
library(readxl)

#stats
library(psych)
library(lme4)
library(lmerTest)
library(MuMIn)

ggthemr('flat')
```
```{r}
qpcr_data <- read.csv("/Volumes/GoogleDrive-105793286447324059497/My Drive/UF/Data_AcomysDominance/Data for Publication/qpcr_combined_082922.csv")
sex_id <- read_excel("/Volumes/GoogleDrive-105793286447324059497/My Drive/UF/Data_AcomysDominance/Data for Publication/AcomysDomRegen_Inventory.xlsx", sheet = "Sheet1")
ind_ds <- read.csv("/Volumes/GoogleDrive-105793286447324059497/My Drive/UF/Data_AcomysDominance/Data for Publication/dscorebyanimal_edited.csv")
eardata <- read_excel("/Volumes/GoogleDrive-105793286447324059497/My Drive/UF/Data_AcomysDominance/Data for Publication/EarDaysToClose.xlsx")
stability <- read.csv("/Volumes/GoogleDrive-105793286447324059497/My Drive/UF/Data_AcomysDominance/Data for Publication/stabilitybycage.csv")


qpcr_data <- left_join(qpcr_data, sex_id[,c(4,6,15)], by="AnimalID")
qpcr_data <- left_join(qpcr_data, ind_ds[,2:5], by="AnimalID")
qpcr_data <- left_join(qpcr_data, eardata, by="AnimalID")
qpcr_data <- left_join(qpcr_data, stability, by="AnimalID")

qpcr_data$Sex <- as.factor(qpcr_data$Sex)
qpcr_data$Cage.x <- as.factor(qpcr_data$Cage.x)
qpcr_data$GrpSize <- as.factor(qpcr_data$GrpSize)
qpcr_data$dom_status_ds <- as.factor(qpcr_data$dom_status_ds)
qpcr_data$stab_status <- factor(qpcr_data$stab_status, levels=c("Stable", "Unstable", "Unclear"))
```

```{r}
Cyp11a1_m_f <- lmer(GeneExpRat ~  (1|Cage.x) + Sex + ds + stab_status + ds*stab_status, filter(qpcr_data, target.x=="Cyp11a1"), REML=TRUE)
Star_m_f <- lmer(GeneExpRat ~  (1|Cage.x) + Sex + ds + stab_status + ds*stab_status, filter(qpcr_data, target.x=="StAR"), REML=TRUE)
Nr5a1_m_f <- lmer(GeneExpRat ~  (1|Cage.x) + Sex + ds + stab_status + ds*stab_status, filter(qpcr_data, target.x=="Nrb01"), REML=TRUE)
Nrb01_m_f <- lmer(GeneExpRat ~  (1|Cage.x) + Sex + ds + stab_status + ds*stab_status, filter(qpcr_data, target.x=="Nr5a1"), REML=TRUE)
Cyp11b1_m_f <- lmer(GeneExpRat ~  (1|Cage.x) + Sex + ds + stab_status + ds*stab_status, filter(qpcr_data, target.x=="Cyp11b1"), REML=TRUE)

print("Cyp11a1")
anova(Cyp11a1_m_f)
r.squaredGLMM(Cyp11a1_m_f)
print("Star")
anova(Star_m_f)
r.squaredGLMM(Star_m_f)
print("Nr5a1")
anova(Nr5a1_m_f)
summary(Nr5a1_m_f)
r.squaredGLMM(Nr5a1_m_f)
print("Nrb01")
anova(Nrb01_m_f)
r.squaredGLMM(Nrb01_m_f)
print("Cyp11b1")
anova(Cyp11b1_m_f)
r.squaredGLMM(Cyp11b1_m_f)
summary(Cyp11b1_m_f)
```

```{r}
cyp11b1 <- qpcr_data %>% 
  filter(target.x != "GAPDH")

cyp_plot <- ggplot(cyp11b1, aes(target.x, GeneExpRat, fill=Sex, color=Sex))+
  geom_dotplot(binaxis='y', stackdir='center', position=position_dodge(0.75), binwidth = 0.0125)+
  stat_summary(fun=median, size=0.5, geom="crossbar", width=0.5, position=position_dodge(width=0.75))+
  scale_fill_npg()+
  scale_color_npg()+
  xlab("") + ylab("Gene expression ratio")+
  theme(text = element_text(size = 9)) 

cyp_plot
```
```{r}
Nr5a1 <- qpcr_data %>% 
  filter(target.x == "Nr5a1")

Nr_plot <- ggplot(Nr5a1, aes(ds, GeneExpRat))+
  geom_point(aes(color=stab_status), size=4)+
  geom_smooth(aes(color=stab_status), method=lm, se=FALSE, size=1.5)+
  scale_x_continuous(limits=c(-3,3), breaks=c(-3,-2,-1,0,1,2,3))+
  scale_color_npg()+
  xlab("David's Score") + ylab("Gene expression ratio \nNr5a1")+
  labs(color="Stability")+
  theme(text = element_text(size = 9)) 

Nr_plot
```


```{r}

qplot <- plot_grid(
  cyp_plot, Nr_plot,
  labels="AUTO", ncol=1, align="v",
  label_size = 11
)

ggsave("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/R generated figures/Fig6_qpcr_plots.tiff", qplot, units="in", width = 6.5, height =4, device='tiff', dpi=300)

qplot

```

