---
title: "10. qPCR (cont.)"
author: "varholick"
date: "1/3/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#plots
library(tidyverse)
library(ggplot2)
library(ggbeeswarm)
library(ggthemr) #devtools::install_github('Mikata-Project/ggthemr')
library(ggsci)
library(ggpubr)
library(cowplot)
library(readxl)

#stats
library(lme4)
library(lmerTest)
library(MuMIn)

ggthemr('flat')
```
```{r}
qpcr_data <- read.csv("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/qpcr_combined_011623.csv")
sex_id <- read_excel("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/AcomysDomRegen_Inventory.xlsx", sheet = "Sheet1")
ind_ds <- read.csv("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/dscorebyanimal_edited.csv")
eardata <- read_excel("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/EarDaysToClose.xlsx")
stability <- read.csv("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/Data/stabilitybycage.csv")


qpcr_data <- left_join(qpcr_data, sex_id[,c(4,6,15)], by="AnimalID")
qpcr_data <- left_join(qpcr_data, ind_ds[,2:5], by="AnimalID")
qpcr_data <- left_join(qpcr_data, eardata, by="AnimalID")
qpcr_data <- left_join(qpcr_data, stability, by="AnimalID")

qpcr_data$Sex <- as.factor(qpcr_data$Sex)
qpcr_data$Cage.x <- as.factor(qpcr_data$Cage.x)
qpcr_data$GrpSize <- as.factor(qpcr_data$GrpSize)
qpcr_data$dom_status_ds <- as.factor(qpcr_data$dom_status_ds)
qpcr_data$stab_status <- factor(qpcr_data$stab_status2, levels=c("Enforced stable", "Unstable", "Unenforced stable", "Unmeasurable"))
```

```{r}
Cyp11a1_m_f <- lm(GeneExpRat ~ Sex + ds + stab_status2 + ds*stab_status2, filter(qpcr_data, target.x=="Cyp11a1"))
Star_m_f <- lm(GeneExpRat ~ Sex + ds + stab_status2 + ds*stab_status2, filter(qpcr_data, target.x=="StAR"))
Nr5a1_m_f <- lm(GeneExpRat ~ Sex + ds + stab_status2 + ds*stab_status2, filter(qpcr_data, target.x=="Nrb01"))
Nrb01_m_f <- lm(GeneExpRat ~ Sex + ds + stab_status2 + ds*stab_status2, filter(qpcr_data, target.x=="Nr5a1"))
Cyp11b1_m_f <- lm(GeneExpRat ~  Sex + ds + stab_status2 + ds*stab_status2, filter(qpcr_data, target.x=="Cyp11b1"))

print("Cyp11a1")
anova(Cyp11a1_m_f)
summary(Cyp11a1_m_f)
print("Star")
anova(Star_m_f)
r.squaredGLMM(Star_m_f)
print("Nr5a1")
anova(Nr5a1_m_f)
print("Nrb01")
anova(Nrb01_m_f)
summary(Nrb01_m_f)
print("Cyp11b1")
anova(Cyp11b1_m_f)
summary(Cyp11b1_m_f)
```

```{r}
cyp11b1 <- qpcr_data %>% 
  filter(target.x != "GAPDH")

cyp_plot <- ggplot(cyp11b1, aes(target.x, GeneExpRat, fill=Sex, color=Sex))+
  geom_dotplot(binaxis='y', stackdir='center', position=position_dodge(0.75), binwidth = 0.0125)+
  stat_summary(fun=median, size=0.5, geom="crossbar", width=0.5, position=position_dodge(width=0.75))+
  scale_fill_npg()+
  scale_color_npg()+
  xlab("") + ylab("Relative ∆Ct to ActinB")+
  theme(text = element_text(size = 9)) 

cyp_plot
```
```{r}
Nr5a1 <- qpcr_data %>% 
  filter(target.x == "Nr5a1")

Nr_plot <- ggplot(Nr5a1, aes(ds, GeneExpRat))+
  geom_point(aes(color=stab_status), size=4)+
  geom_smooth(aes(color=stab_status), method=lm, se=FALSE, size=1.5)+
  scale_x_continuous(limits=c(-3,3), breaks=c(-3,-2,-1,0,1,2,3))+
  scale_color_npg()+
  xlab("David's Score") + ylab("Nr5a1 \nRelative ∆Ct to ActinB")+
  labs(color="Type of \n Dom. Relationship")+
  annotate("text", x = c(-1,1), y = c(.95,.95), label = c("more subordinate","more dominant"))+
  theme(text = element_text(size = 9), legend.position="none") 

Nr_plot
```
```{r}
Cyp11a1 <- qpcr_data %>% 
  filter(target.x == "Cyp11a1")

Cypa_plot <- ggplot(Cyp11a1, aes(ds, GeneExpRat))+
  geom_point(aes(color=stab_status), size=4)+
  geom_smooth(aes(color=stab_status), method=lm, se=FALSE, size=1.5)+
  scale_y_continuous(limits=c(1,1.3), breaks=c(1, 1.1, 1.2, 1.3))+
  scale_x_continuous(limits=c(-3,3), breaks=c(-3,-2,-1,0,1,2,3))+
  scale_color_npg()+
  xlab("David's Score") + ylab("Cyp11a1 \nRelative ∆Ct to ActinB")+
  labs(color="Type of \n Dom. Relationship")+
  annotate("text", x = c(-1.5,1.5), y = c(1,1), label = c("more subordinate","more dominant"))+
  theme(text = element_text(size = 9), legend.position="none") 

Cypa_plot
```
```{r}
Nrb01 <- qpcr_data %>% 
  filter(target.x == "Nrb01")

nrb_plot <- ggplot(Nrb01, aes(ds, GeneExpRat))+
  geom_point(aes(color=ds), size=4)+
  geom_smooth(method=lm, se=FALSE, size=1.5, color="black")+
  scale_x_continuous(limits=c(-3,3), breaks=c(-3,-2,-1,0,1,2,3))+
  scale_color_gsea()+
  xlab("David's Score") + ylab("Nr0b1 \nRelative ∆Ct to ActinB")+
  annotate("text", x = c(-1.5,1.5), y = c(.95,.95), label = c("more subordinate","more dominant"))+
  labs(color="David's \nscore")+
  theme(text = element_text(size = 9), legend.position="none")

nrb_plot
```
```{r}
cypb <- qpcr_data %>% 
  filter(target.x == "Cyp11b1")

cypb_plot <- ggplot(cypb, aes(stab_status, GeneExpRat, color=stab_status, fill=stab_status))+
  geom_dotplot(binaxis='y', stackdir='center', position=position_dodge(0.75), binwidth = 0.0125)+
  stat_summary(fun=median, size=0.5, geom="crossbar", width=0.5, position=position_dodge(width=0.75))+
  scale_fill_npg()+
  scale_color_npg()+
  xlab("Type of Dom. Relationship") + ylab("Cyp11b1 \nRelative ∆Ct to ActinB")+
  theme(text = element_text(size = 9), legend.position="none", axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) 

cypb_plot
```


```{r}

secondplot <- plot_grid(nrb_plot, cypb_plot, labels=c("B", "C"), ncol=1, label_size=11)

qplot <- plot_grid(
  Cypa_plot, secondplot,
  labels="AUTO",  ncol=2,
  label_size = 11
)

ggsave("/Users/justinvarholick/Documents/GitHub/AcomysDominance_2022_Data_Results/R generated figures/Fig6_qpcr_plots_rev.tiff", qplot, units="in", width = 20, height =10, device='tiff', dpi=300)

qplot

```

